
{% import "./form.twig" as forms %}

{% macro fieldAttr(def) %}
{% for key, value in def %}{{ key }}='{{ value }}'{% endfor %}
{% endmacro %}

{% macro renderSet(obj, path, index, max, tag = 'div') %}
    {% set prefix = 'bs-' %}
    {% set formItemKey = 'formItem' ~ index %}
    {% set formItemLabel = 'key' ~ index %}
{#    {{ formItemLabel }}#}
    {% if index < max %}
    <{{ tag }} class="{{ prefix }}{{ formItemLabel }}"
         v-for="({{ formItemKey }}, {{ formItemLabel }}) in {{ obj }}">
        {% set defPath =   obj ~ '[' ~ formItemLabel ~ ']'   %}
        <template v-if="{{ formItemKey }}.type !== 'array' ">
            <cm-field v-model="{{ path }}[{{ formItemLabel }}]"
                      :label="{{ formItemLabel }}" :prop="{{ formItemLabel }}"
                      :form-path="'{{ path }}.' + '{{ formItemLabel }}'"
                      :type="{{ formItemKey }}.type" :ui="{{ formItemKey }}.ui"></cm-field>
        </template>
        <template v-if="{{ formItemKey }}.type === 'array' ">
            {% set subItemKey = 'subItem' ~ index %}
            {% set subItemLabel = 'subIndex' ~ index %}
            <{{ tag}} class="{{ prefix }}{{ formItemLabel }}__{{ subItemLabel }}" v-for="({{ subItemKey }}, {{ subItemLabel }}) in {{ path }}[{{ formItemLabel }}]">
                {% set scopePath = path ~ '[' ~ formItemLabel ~ '][' ~ subItemLabel ~ ']'  %}
                {% set objPath = defPath ~ '.items.properties' %}
{#                {{ objPath }} {% verbatim %}{{ {% endverbatim %} {{ objPath }} {% verbatim %} }} {% endverbatim %}#}
                {{ _self.renderSet(objPath, scopePath, index + 1, max, tag) }}
            </{{ tag }}>
        </template>
    </{{ tag }}>
    {% else %}
{#        {{ obj }} {{ path }}#}

{#        {% verbatim %} {{ {% endverbatim %} {{ obj }} {% verbatim %} }} {% endverbatim %}#}
        <template
             v-for="(subFormItem, subKey) in {{ obj }}">
{#            {% verbatim %}{{ formItemLabel }}{% endverbatim %}#}

{#            {% verbatim %} {{ {% endverbatim %} {{ path[] }} {% verbatim %} }} {% endverbatim %}#}
            <cm-field v-model="{{ path }}[subKey]"
                      :label="subKey" :prop="subKey"
                      :form-path="'{{ path }}.' + subKey"
                      :type="subFormItem.type" :ui="subFormItem.ui"></cm-field>
        </template>
    {% endif %}
{% endmacro %}

{% macro formItem(modelPath) %}
    <template v-if="type === 'string'">
        {{forms.input(modelPath)}}
    </template>
    <template v-if="type === 'number'">
        {{forms.inputNumber(modelPath)}}
    </template>
    <template v-if="type === 'integer'">
        {{forms.inputNumber(modelPath)}}
    </template>
    <template v-if="type === 'radio'">
        {{forms.radio(modelPath)}}
    </template>
    <template v-if="type === 'radioBoolean'">
        {{forms.radioBoolean(modelPath)}}
    </template>
    <template v-if="type === 'checkbox'">
        {{forms.checkbox(modelPath)}}
    </template>
    <template v-if="type === 'select'">
        {{forms.select(modelPath)}}
    </template>
{% endmacro %}

{% macro fieldset(formDef, path) %}
    {% if formDef.type == 'object' %}
        {% for key , formItem in formDef.properties %}
                {% set scopeModelKey = path ~  key %}
                {% if formItem.type == 'string' %}
<el-form-item prop="{{key}}" model-path="{{ scopeModelKey }}" label="{{ key }}">
{{forms.input(scopeModelKey)}}
</el-form-item>
                {% endif %}
                {% if formItem.type == 'number' %}
<el-form-item prop="{{key}}" model-path="{{ scopeModelKey }}"  label="{{ key }}">
{{forms.inputNumber(scopeModelKey)}}
</el-form-item>
                {% endif %}
                {% if formItem.type == 'integer' %}
<el-form-item prop="{{key}}" model-path="{{ scopeModelKey }}"  label="{{ key }}">
                    {{forms.inputNumber(scopeModelKey)}}
</el-form-item>
                {% endif %}
                {% if formItem.type == 'boolean' %}
<el-form-item prop="{{key}}" model-path="{{ scopeModelKey }}"  label="{{ key }}">
                    {{forms.radioBoolean(scopeModelKey)}}
</el-form-item>
                {% endif %}
        {% endfor %}
    {% endif %}
{% endmacro %}
